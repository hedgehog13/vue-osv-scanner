<template>
  <div class="container">
    <!-- Left: Main Table -->
    <div class="table-container">
      <h3>Vulnerabilities Found:</h3>
      <table>
        <thead>
          <tr>
            <th>Package</th>
            <th>Vulnerabilities</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(result, index) in results" :key="index">
            <td>{{ result.package }}</td>
            <td>{{ result.vulnerabilities.length }}</td>
            <td>
              <button
                @click="toggleDetails(index)"
                v-if="result.vulnerabilities.length > 0"
                class="details-btn"
              >
                {{ expandedRow === index ? 'Hide' : 'View' }}
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Right: Details Panel -->
    <VulnerabilityDetails v-if="expandedRow !== null" :vulnerability="results[expandedRow]" />
  </div>
</template>

<script setup lang="ts">
import { useVulnerabilityTable } from './VulnerabilityTable.ts'
import VulnerabilityDetails from '@/components/VulnerabilityDetails/VulnerabilityDetails.vue'

defineProps<{
  results: Array<{
    package: string
    vulnerabilities: Array<{ id: string; summary: string; severity: string }>
  }>
}>()

const { expandedRow, toggleDetails } = useVulnerabilityTable()
</script>

<style scoped src="./VulnerabilityTable.css"></style>
